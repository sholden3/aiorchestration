{
  "$schema": "https://governance.ai/schemas/rules/archival/v1.0.0",
  "version": "1.0.0",
  "last_updated": "2025-01-28T21:00:00Z",
  "description": "Mandatory archival procedures from CLAUDE.md",
  
  "archival_triggers": {
    "file_replacement": {
      "always_archive": true,
      "exceptions": ["*.log", "*.tmp", ".cache"]
    },
    "major_refactoring": {
      "threshold_lines": 100,
      "archive_before": true
    },
    "deletion": {
      "archive_first": true,
      "retention_days": 90
    }
  },
  
  "pre_archival_requirements": {
    "approvals": {
      "required_personas": ["alex_novak", "sarah_chen"],
      "unanimous": true,
      "documented": true
    },
    "documentation": {
      "readme_required": true,
      "readme_location": "archive/{category}/README.md",
      "must_include": [
        "reason_for_archival",
        "performance_comparison",
        "rollback_procedure",
        "dependencies_affected",
        "date_archived",
        "archived_by",
        "original_location"
      ]
    }
  },
  
  "archive_structure": {
    "base_path": "archive/",
    "categories": {
      "test_infrastructure": "Test-related files",
      "backend_components": "Backend service files",
      "frontend_components": "Frontend/Angular files",
      "configuration": "Config files",
      "documentation": "Superseded documentation",
      "unused_code": "Code no longer in use",
      "experiments": "Experimental implementations"
    },
    "subfolders_by_date": true
  },
  
  "naming_convention": {
    "format": "{date}_{original_filename}_v{version}_{reason}.{ext}",
    "date_format": "YYYY-MM-DD",
    "reason_mapping": {
      "refactor": "Code refactoring",
      "performance": "Performance improvement",
      "bugfix": "Bug fix replacement",
      "security": "Security vulnerability",
      "deprecated": "Deprecated functionality",
      "experimental": "Experimental code"
    },
    "examples": [
      "2025-01-28_test-setup-electron_v1_baseline.ts",
      "2025-01-28_cache-manager_v2_performance.py"
    ]
  },
  
  "rollback_procedure": {
    "steps": [
      "Locate archived file in appropriate directory",
      "Verify file integrity and version",
      "Copy back to original location",
      "Run validation tests",
      "Update documentation",
      "Document rollback reason"
    ],
    "max_rollback_time": "5 minutes",
    "test_requirements": [
      "Unit tests must pass",
      "Integration tests must pass",
      "No regression detected"
    ]
  },
  
  "metadata_tracking": {
    "archive_manifest": "archive/MANIFEST.json",
    "per_file_metadata": {
      "original_path": "string",
      "archive_path": "string",
      "date_archived": "ISO8601",
      "archived_by": "persona_id",
      "reason": "string",
      "rollback_count": "number",
      "dependencies": ["array of files"],
      "performance_metrics": {
        "before": {},
        "after": {}
      }
    }
  },
  
  "retention_policy": {
    "default_retention_days": 90,
    "by_category": {
      "configuration": 365,
      "backend_components": 180,
      "frontend_components": 180,
      "test_infrastructure": 90,
      "documentation": 365,
      "unused_code": 30,
      "experiments": 30
    },
    "never_delete": [
      "security_related",
      "compliance_required",
      "audit_trail"
    ]
  },
  
  "enforcement": {
    "unapproved_archival": {
      "level": "error",
      "blocks_operation": true,
      "message": "Both Alex and Sarah must approve archival"
    },
    "missing_documentation": {
      "level": "error",
      "blocks_operation": true,
      "message": "Archive README.md required"
    },
    "invalid_naming": {
      "level": "error",
      "blocks_operation": true,
      "message": "Follow naming convention"
    },
    "missing_tests": {
      "level": "warning",
      "message": "Archived code should have test coverage"
    }
  }
}
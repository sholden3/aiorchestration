{
  "$schema": "https://governance.ai/schemas/rules/persistence/v1.0.0",
  "version": "1.0.0",
  "last_updated": "2025-01-28T21:00:00Z",
  "description": "Database and caching governance rules",
  
  "database_integration": {
    "postgres_storage": {
      "tables": {
        "governance_correlations": {
          "description": "Store all correlation tracking data",
          "retention_days": 90,
          "indexes": ["correlation_id", "user", "timestamp"]
        },
        "governance_decisions": {
          "description": "All governance decisions and approvals",
          "retention_days": 365,
          "indexes": ["decision_id", "timestamp", "personas"]
        },
        "governance_sessions": {
          "description": "Development session tracking",
          "retention_days": 30,
          "indexes": ["session_id", "user", "start_time"]
        },
        "governance_violations": {
          "description": "Rule violations and exemptions",
          "retention_days": 180,
          "indexes": ["violation_id", "rule_id", "timestamp"]
        },
        "governance_audit_trail": {
          "description": "Complete audit trail",
          "retention_days": 2555,
          "indexes": ["event_id", "timestamp", "correlation_id"]
        }
      },
      "migration_strategy": {
        "from_json": true,
        "versioned_migrations": true,
        "rollback_support": true,
        "zero_downtime": true
      },
      "performance": {
        "connection_pool_size": 10,
        "query_timeout_ms": 5000,
        "batch_insert_size": 1000,
        "vacuum_schedule": "daily"
      }
    },
    
    "data_to_persist": {
      "immediate": [
        "correlation_contexts",
        "governance_decisions",
        "rule_violations"
      ],
      "batch": [
        "session_metrics",
        "performance_data",
        "audit_events"
      ],
      "async": [
        "file_changes",
        "test_results",
        "coverage_reports"
      ]
    }
  },
  
  "cache_integration": {
    "cache_strategy": {
      "hot_cache": {
        "items": [
          "active_personas",
          "validation_rules",
          "session_context",
          "recent_decisions"
        ],
        "ttl_seconds": 300,
        "max_size_mb": 100
      },
      "warm_cache": {
        "items": [
          "correlation_history",
          "rule_configurations",
          "persona_definitions",
          "consensus_strategies"
        ],
        "ttl_seconds": 3600,
        "max_size_mb": 500
      }
    },
    
    "cache_keys": {
      "format": "governance:{category}:{id}:{timestamp}",
      "categories": [
        "correlation",
        "decision",
        "session",
        "rule",
        "persona"
      ],
      "invalidation": {
        "on_update": true,
        "cascade": true,
        "broadcast": true
      }
    },
    
    "performance_targets": {
      "hit_rate": 0.9,
      "response_time_ms": 10,
      "eviction_strategy": "LRU",
      "preload_on_start": true
    }
  },
  
  "data_sync": {
    "sync_strategy": {
      "mode": "eventual_consistency",
      "sync_interval_seconds": 60,
      "conflict_resolution": "last_write_wins",
      "retry_policy": {
        "max_attempts": 3,
        "backoff": "exponential"
      }
    },
    
    "data_flow": {
      "json_to_db": {
        "schedule": "every_5_minutes",
        "batch_size": 100,
        "validation": true
      },
      "db_to_cache": {
        "trigger": "on_query",
        "ttl": 3600,
        "compression": true
      },
      "cache_to_json": {
        "trigger": "on_shutdown",
        "backup": true,
        "encrypt": false
      }
    }
  },
  
  "monitoring": {
    "metrics_to_track": [
      "database_query_time",
      "cache_hit_rate",
      "sync_lag_seconds",
      "storage_size_bytes",
      "active_connections"
    ],
    "alerts": {
      "cache_hit_below": 0.8,
      "query_time_above_ms": 1000,
      "sync_lag_above_seconds": 300,
      "connection_pool_exhausted": true
    },
    "dashboards": {
      "governance_overview": {
        "widgets": [
          "active_sessions",
          "recent_violations",
          "decision_timeline",
          "cache_performance"
        ]
      },
      "performance_monitoring": {
        "widgets": [
          "query_performance",
          "cache_metrics",
          "sync_status",
          "error_rates"
        ]
      }
    }
  },
  
  "enforcement": {
    "database_unavailable": {
      "level": "warning",
      "fallback": "json_files",
      "message": "Operating in degraded mode"
    },
    "cache_miss_high": {
      "level": "warning",
      "action": "rebuild_cache",
      "threshold": 0.2
    },
    "sync_failure": {
      "level": "error",
      "retry": true,
      "alert_admins": true
    },
    "data_corruption": {
      "level": "critical",
      "action": "restore_from_backup",
      "block_operations": true
    }
  }
}